$('document').ready(inicia_usuarios);

function inicia_usuarios() {
    $('[data-toggle="tooltip"]').tooltip();
    $('#cumpleanos').datepicker(datepickerOptions());

    /**
     * envio de informacion para guardar los usuarios
     */
    $("#formUsuarios").on("submit", guardarUsuarios);

    listarUsuario();

}

function guardarUsuarios(e) {
    e.preventDefault();
    ajax_send("routing.php?modulo=3&funcion=insertUser", $(this).serialize())
        .done((data) => {
            if (data.valido) {
                swalAlertTimer(data.mensaje, "", "success", data.tiempo);
                $(this)[0].reset()
                return false;
            }
            swalAlertTimer(data.mensaje, "", "error", data.tiempo);
        })
}

function listarUsuario() {
    ajax_send("routing.php", {modulo: 3, funcion: "listarUsuarios"}).done((data) => {
        let columnas = [
            {
                "data": "documento", title: "Documento", className: "text-center", render: function (data, type, row) {
                    return "<span style='cursor: pointer;'>" + data + "</span>";
                }
            },
            {"data": "nombre", title: "Nombre"},
            {"data": "apellido", title: "Apellido"},
            {"data": "telefono", title: "Telefono"},
            {"data": "perfil", title: "Perfil"},
            {
                "data": "activo", title: "Activo", className: "text-center", render: function (data, type, row) {
                    return (+data === 1) ? "<i class='fa fa-circle' style='color: green' data-toggle='tooltip' data-placement='top' title='Usuario activo'></i>" : "<i class='fa fa-circle' style='color: red' data-toggle='tooltip' data-placement='top' title='Usuario inactivo'></i>";
                }
            },
            // {
            //     "data": null,
            //     defaultContent: "<div class='btn-group'><button type='button' class='btn btn-outline-success' data-toggle='tooltip' data-placement='top' title='Editar Usuario'><i class='fa fa-edit'></i></button> <button type='button' class='btn btn-outline-danger' data-toggle='tooltip' data-placement='top' title='Eliminar Usuario'><i class='fa fa-trash'></i></button> <button type='button' class='btn btn-outline-info' data-toggle='tooltip' data-placement='top' title='Nomina Usuario'><i class='fa fa-calculator'></i></button> </div>",
            //     title: "Acciones"
            // }
            {
                "data": "cod_usuario", title: "Acciones", className: "text-center", render: function (data, type, row) {
                    return "<div class='btn-group'>"
                        +"<button type='button' class='btn btn-outline-success' data-toggle='tooltip' data-placement='top' title='Editar Usuario' data-codigo='"+data+"'><i class='fa fa-edit'></i></button>"
                        +"<button type='button' class='btn btn-outline-danger' data-toggle='tooltip' data-placement='top' title='Eliminar Usuario'><i class='fa fa-trash'></i></button> "
                        +"<button type='button' class='btn btn-outline-info' data-toggle='tooltip' data-placement='top' title='Nomina Usuario'><i class='fa fa-calculator'></i></button> "
                        +"</div>";
                }
            }
        ]
        $("#usuariosTable").DataTable(dataTableOptions(data, columnas))
    });
}